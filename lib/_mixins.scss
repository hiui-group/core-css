// Author: Sivan[sunxingfan@xiaomi.com]
// Description: define mix-ins, functions etc.

@import 'common';

/// Slightly lighten a color
/// @access private
/// @param {Color} $color - color to tint
/// @param {Number} $percentage - percentage of `$color` in returned color
/// @return {Color}
@function use-color($color-name: '') {
  @return var(--color#{if($color-name != '', '-' + $color-name, null)});
}

/// Deprecated: Convert hex color to hsl format
/// @deprecated
/// @access public
@function hex-to-hsl($color) {
  @return hue($color), saturation($color), lightness($color);
}

/// Helper to clear inner floats
/// @access public
@mixin clearfix() {
  &::after {
    content: '';
    display: table;
    clear: both;
  }
}

/// Text ellipsis
/// @access public
@mixin ellipsis() {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

/// Image Replacement
/// @access public
@mixin hide-text() {
  overflow: hidden;
  text-indent: 100%;
  white-space: nowrap;
}

/// Get CSS variables, generate css variables snippet by given color
/// @access public
@mixin get-vars($color: get-color($palette_primary, 'hiui-blue')) {
  --color-primary: #{$color};  // primary color
  --color-primary-h: #{hue($color)};
  --color-primary-s: #{saturation($color)};
  --color-primary-l: #{lightness($color)};
  --color-primary-bg: #{tint($color, 90%)};  // hover color
  //--color-primary-hsl: #{var(--color-primary-h), var(--color-primary-s), var(--color-primary-l)};
  --color-primary-10: #{tint($color, 50%)};
  --color-primary-20: #{tint($color, 40%)};
  --color-primary-30: #{tint($color, 30%)};
  --color-primary-40: #{tint($color, 20%)}; // base color hover
  --color-primary-60: #{shade($color, 10%)}; // base color active
  --color-primary-70: #{shade($color, 20%)};
  --color-primary-80: #{shade($color, 30%)};
  --color-primary-90: #{shade($color, 40%)};
  //--color-primary-g50: #{mix(mix(#000, $color, 90%), #fff, 15%)};
  //--color-primary-g60: #{mix(mix(#000, $color, 90%), #fff, 20%)};
  //--color-primary-g70: #{mix(mix(#000, $color, 90%), #fff, 26%)};
  //--color-primary-g80: #{mix(mix(#000, $color, 90%), #fff, 35%)};
  //--color-primary-g90: #{mix(mix(#000, $color, 90%), #fff, 50%)};
  //--color-primary-g100: #{mix(mix(#000, $color, 90%), #fff, 80%)};
  --color-black: #{get-color($palette-tertiary, 'black')}; // text
  --color-gray-darker: #{get-color($palette-tertiary, 'gray-darker')};
  --color-gray-dark: #{get-color($palette-tertiary, 'gray-dark')}; // border color
  --color-gray: #{get-color($palette-tertiary, 'gray')};
  --color-gray-light: #{get-color($palette-tertiary, 'gray-light')};
  --color-gray-lighter: #{get-color($palette-tertiary, 'gray-lighter')};
  --color-white: #{get-color($palette-tertiary, 'white')}; // white
}

/// Use CSS variable
/// @access public
/// @Todo: switch to postcss
/// @example:
/// :root {
///   --color-brand: #ff6700;
/// }
/// .modern {
///   @include use-var(background-color, color-brand);
/// }
/// .modern-with-fallback {
///   @include use-var(background-color, color-brand, #000);
/// }
/// .legacy {
///   @include use-var(background-color, color-brand, #000, true);
/// }
/// .legacy-with-test {
///   @include use-var(background-color, color-brand, #000, '.no-custom-properties');
/// }
@mixin use-var($property, $value, $fallback: false, $compatible-mode: false) {
  // if fallback value given
  @if $fallback {
    // if need compatible selector
    @if $compatible-mode {
      @if type-of($compatible-mode) == string {
        #{$property}: var(--#{$value}, #{$fallback});

        #{$compatible-mode} & {
          #{$property}: $fallback;
        }
      } @else {
        #{$property}: $fallback;
        #{$property}: var(--#{$value}, #{$fallback});
      }
    } @else {
      #{$property}: var(--#{$value}, #{$fallback});
    }
  } @else {
    #{$property}: var(--#{$value});
  }
}

/// Isolate component style
/// @access public
/// block elements reset: margin, padding, text style, <ul>, <ol>
/// inline-block elements reset: margin, padding, text style
/// inline elements reset: TBD.
/// @example:
/// .hi-btn {
///   @include isolation('inline', 'flow-root');
///   ...
/// }
@mixin isolation($display-outside: 'block', $display-inside: 'flow-root', $is-root: true) {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
  border: 0;

  // equal to `display: inline`
  @if not ($display-outside == 'inline' and $display-inside == 'flow') {
    font: normal $font-weight-normal #{$font-size-normal}/#{$line-height-size-normal} $font-family-sans;
    text-align: left;
    text-decoration: none;
    text-indent: 0;
    text-shadow: none;
    text-transform: none;
    letter-spacing: 0;
    word-spacing: normal;
    white-space: normal;
    color: use-color('black');
  }

  // equal to `display: block`
  @if ($display-outside == 'block' and $display-inside == 'flow-root') {
    ul,
    ol {
      margin: 0;
      padding: 0;
      list-style: none;
    }
  }
}
